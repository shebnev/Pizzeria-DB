# SQL Analytics Project: Pizzeria Business Metrics

## Описание проекта

Проект посвящён аналитике операционных и финансовых показателей пиццерии.
Цель — показать умение работать с реальными бизнес-метриками, оптимизировать запросы, применять оконные функции, CTE и аналитические подходы.

---

## Оптимизация производительности

```sql
CREATE INDEX idx_orders_status ON orders (status);
```

Индекс добавлен для ускорения аналитических запросов, активно фильтрующих данные по статусу заказа (`Доставлен`, `Отменен`).

---

## Lost Revenue Rate (Потерянная выручка)

### Смысл метрики

Оценка масштаба потерь из-за отменённых заказов.

### Логика расчёта

* Берутся только заказы со статусом **«Отменен»**
* Анализируются позиции заказа (`order_items`)
* Считается агрегированная потерянная выручка

---

## Deliver Underutilization (Недозагруженность курьеров)

### Смысл метрики

Позволяет выявить курьеров, которые выполняют значительно меньше заказов по сравнению с «нормой» (медианной нагрузкой).

### Этапы расчёта

1. **courier_stats**
    * Количество доставленных заказов
    * Количество активных рабочих дней

2. **courier_load**
    * Среднее число доставок в день

3. **ranked**
   * Ранжирование курьеров по нагрузке

4. **benchmark**
   * Расчёт медианной нагрузки

5. **Финальный результат**
   * Отношение нагрузки курьера к медиане (`underutilization_ratio`)

### Почему медиана

Медиана устойчива к выбросам и лучше отражает «типичную» нагрузку, чем среднее арифметическое.

---

## Top-10 Dependency Rate (Зависимость от клиентов)

### Смысл метрики

Показывает, какую долю выручки формируют крупнейшие клиенты.
Помогает оценить риск зависимости бизнеса от ограниченного числа заказчиков.

### Логика расчёта

* Считается общая выручка по доставленным заказам
* Для каждого клиента считается вклад в общую выручку
* Рассчитывается процент зависимости
* Выбирается **TOP-10 клиентов**

---

## Используемые SQL-концепции

* Индексы
* CTE (WITH)
* Оконные функции
* Агрегации
* Аналитические метрики
* NULL-safe операции
* Оптимизация запросов
* Читаемая и логически структурированная SQL-логика